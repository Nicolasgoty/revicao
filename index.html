<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Organizador Financeiro — Tela Inicial</title>
  <style>
    :root{--bg:#f4f6f8;--card:#ffffff;--accent:#2b6cb0;--muted:#6b7280}
    *{box-sizing:border-box;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial}
    body{margin:0;background:var(--bg);color:#0f172a;padding:28px}
    .container{max-width:980px;margin:0 auto}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 6px 24px rgba(15,23,42,0.06);margin-bottom:16px}
    .grid{display:grid;gap:12px}
    .cols-3{grid-template-columns:1fr 1fr 1fr}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type="number"], input[type="text"], select, textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ef;font-size:14px}
    button{padding:10px 12px;border-radius:8px;border:0;background:var(--accent);color:white;font-weight:600;cursor:pointer}
    .muted{color:var(--muted);font-size:13px}
    .row{display:flex;gap:12px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid #eef2f6;text-align:left;font-size:14px}
    th{font-size:13px;color:var(--muted)}
    .right{text-align:right}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#eef6ff;color:#1e3a8a;font-weight:600;font-size:13px}
    .controls{display:flex;gap:8px;align-items:center}
    @media (max-width:720px){.cols-3{grid-template-columns:1fr}.row{flex-direction:column}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Organizador Financeiro — Tela Inicial</h1>
      <div class="muted">Simples, rápido e local (dados no seu navegador)</div>
    </header>

    <section class="card">
      <h3 style="margin-top:0">Adicionar Renda Mensal</h3>
      <div class="grid cols-3" style="align-items:end">
        <div>
          <label for="incomeMonth">Mês</label>
          <input id="incomeMonth" type="month" />
        </div>
        <div>
          <label for="incomeValue">Valor Recebido (R$)</label>
          <input id="incomeValue" type="number" min="0" step="0.01" placeholder="0.00" />
        </div>
        <div>
          <button id="addIncome">Adicionar Renda</button>
        </div>
      </div>
      <div style="margin-top:16px;overflow:auto;max-height:200px">
        <table id="incomeTable">
          <thead>
            <tr><th>Mês</th><th class="right">Valor (R$)</th><th>Ações</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div style="margin-top:12px" class="muted">Total de renda acumulada: <strong id="totalIncome">R$ 0,00</strong></div>
    </section>

    <section class="card">
      <h3 style="margin-top:0">Adicionar gasto</h3>
      <div class="grid cols-3" style="align-items:end">
        <div>
          <label for="desc">Descrição</label>
          <input id="desc" type="text" placeholder="Ex: Mercado, Internet, Transporte" />
        </div>
        <div>
          <label for="category">Categoria</label>
          <select id="category">
            <option>Alimentação</option>
            <option>Transporte</option>
            <option>Moradia</option>
            <option>Lazer</option>
            <option>Saúde</option>
            <option>Outros</option>
          </select>
        </div>
        <div>
          <label for="amount">Valor (R$)</label>
          <input id="amount" type="number" min="0" step="0.01" placeholder="0.00" />
        </div>
      </div>
      <div style="margin-top:12px;display:flex;gap:12px;align-items:center">
        <label for="date" class="muted">Data</label>
        <input id="date" type="date" />
        <button id="addExpense">Adicionar Gasto</button>
      </div>
    </section>

    <section class="card">
      <h3 style="margin:0 0 12px 0">Gastos</h3>
      <div style="overflow:auto;max-height:320px">
        <table id="expensesTable">
          <thead>
            <tr><th>Descrição</th><th>Categoria</th><th>Data</th><th class="right">Valor (R$)</th><th>Ações</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
        <div class="muted">Total de gastos: <strong id="totalSpent">R$ 0,00</strong></div>
        <div class="muted">Total de renda: <strong id="showIncome">R$ 0,00</strong> — Saldo restante: <strong id="remaining">R$ 0,00</strong></div>
      </div>
    </section>

    <section class="card muted" style="text-align:center;font-size:13px">Dicas: Registre sua renda mensal e seus gastos. Os dados são salvos localmente no navegador (localStorage).</section>
  </div>

  <script>
    const qs = id => document.getElementById(id);
    let state = {incomes:[], expenses:[]};

    function formatBR(value){
      const n = Number(value || 0);
      return n.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
    }

    function saveState(){
      localStorage.setItem('fin_state_v2', JSON.stringify(state));
      render();
    }

    function loadState(){
      const raw = localStorage.getItem('fin_state_v2');
      if(raw){
        try{state = JSON.parse(raw);}catch(e){state={incomes:[],expenses:[]}};
      }
      render();
    }

    function render(){
      const tbodyIncome = qs('incomeTable').querySelector('tbody');
      tbodyIncome.innerHTML = '';
      let totalIncome = 0;
      state.incomes.slice().reverse().forEach((inc, idx)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${inc.month}</td><td class="right">${formatBR(inc.value)}</td><td><button data-i="${state.incomes.length-1-idx}" class="delIncome">Remover</button></td>`;
        tbodyIncome.appendChild(tr);
        totalIncome += Number(inc.value || 0);
      });
      qs('totalIncome').textContent = formatBR(totalIncome);

      const tbodyExp = qs('expensesTable').querySelector('tbody');
      tbodyExp.innerHTML = '';
      let totalExp = 0;
      state.expenses.slice().reverse().forEach((exp, idx)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${escapeHtml(exp.desc)}</td><td>${escapeHtml(exp.category)}</td><td>${escapeHtml(exp.date||'')}</td><td class="right">${formatBR(exp.amount)}</td><td><button data-i="${state.expenses.length-1-idx}" class="delExpense">Remover</button></td>`;
        tbodyExp.appendChild(tr);
        totalExp += Number(exp.amount || 0);
      });
      qs('totalSpent').textContent = formatBR(totalExp);
      qs('showIncome').textContent = formatBR(totalIncome);
      qs('remaining').textContent = formatBR(totalIncome - totalExp);

      document.querySelectorAll('.delExpense').forEach(btn=>btn.addEventListener('click', e=>{
        const i = Number(e.currentTarget.getAttribute('data-i'));
        state.expenses.splice(i,1);
        saveState();
      }));

      document.querySelectorAll('.delIncome').forEach(btn=>btn.addEventListener('click', e=>{
        const i = Number(e.currentTarget.getAttribute('data-i'));
        state.incomes.splice(i,1);
        saveState();
      }));
    }

    function escapeHtml(str){
      if(!str) return '';
      return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }

    qs('addIncome').addEventListener('click', ()=>{
      const month = qs('incomeMonth').value;
      const value = parseFloat(qs('incomeValue').value || 0);
      if(!month){alert('Selecione o mês.');return;}
      if(isNaN(value)||value<=0){alert('Informe um valor de renda válido.');return;}
      state.incomes.push({month,value:Number(value)});
      qs('incomeMonth').value='';
      qs('incomeValue').value='';
      saveState();
    });

    qs('addExpense').addEventListener('click', ()=>{
      const desc = qs('desc').value.trim();
      const cat = qs('category').value;
      const amount = parseFloat(qs('amount').value || 0);
      const date = qs('date').value || new Date().toISOString().slice(0,10);
      if(!desc){alert('Preencha a descrição.'); return}
      if(isNaN(amount) || amount <= 0){alert('Valor do gasto deve ser maior que zero.'); return}
      state.expenses.push({desc,category:cat,amount:Number(amount),date});
      qs('desc').value='';qs('amount').value='';qs('date').value='';
      saveState();
    });

    loadState();
  </script>
</body>
</html>
